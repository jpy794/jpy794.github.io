<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>jpy794</title><meta charset=utf-8><meta name=description content="Ladder@I received the email saying that my proposal for GSoC &lsquo;23 was accepted by X.Org Foundation on May 5th. It’s my first time working with open-source communities and I’m really excited about it. My mentor Martin Roukala gave me some great advice and helped me understand the project and my tasks better. Now it’s time to dive into the project details."><meta name=author content="jpy794"><link rel=canonical href=https://jpy794.github.io/blog/gsoc-blog-1/><meta name=google-site-verification content="hkf8Kk9sh38Hm5TzNLXjKJ-Mb3LCSX4b9e4OZ56KXtw"><meta property="og:title" content="The Project - GSoC '23"><meta property="og:description" content="I received the email saying that my proposal for GSoC &lsquo;23 was accepted by X.Org Foundation on May 5th. It’s my first time working with open-source communities and I’m really excited about it. My mentor Martin Roukala gave me some great advice and helped me understand the project and my tasks better. Now it’s time to dive into the project details."><meta property="og:type" content="article"><meta property="og:url" content="https://jpy794.github.io/blog/gsoc-blog-1/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-05-14T20:41:37+08:00"><meta property="article:modified_time" content="2023-05-14T20:41:37+08:00"><meta property="og:see_also" content="https://jpy794.github.io/blog/gsoc-blog-2/"><meta name=twitter:card content="summary"><meta name=twitter:title content="The Project - GSoC '23"><meta name=twitter:description content="I received the email saying that my proposal for GSoC &lsquo;23 was accepted by X.Org Foundation on May 5th. It’s my first time working with open-source communities and I’m really excited about it. My mentor Martin Roukala gave me some great advice and helped me understand the project and my tasks better. Now it’s time to dive into the project details."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blogs","item":"https://jpy794.github.io/blog/"},{"@type":"ListItem","position":3,"name":"The Project - GSoC '23","item":"https://jpy794.github.io/blog/gsoc-blog-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The Project - GSoC '23","name":"The Project - GSoC \u002723","description":"I received the email saying that my proposal for GSoC \u0026lsquo;23 was accepted by X.Org Foundation on May 5th. It’s my first time working with open-source communities and I’m really excited about it. My mentor Martin Roukala gave me some great advice and helped me understand the project and my tasks better. Now it’s time to dive into the project details.\n","keywords":["gsoc"],"articleBody":"I received the email saying that my proposal for GSoC ‘23 was accepted by X.Org Foundation on May 5th. It’s my first time working with open-source communities and I’m really excited about it. My mentor Martin Roukala gave me some great advice and helped me understand the project and my tasks better. Now it’s time to dive into the project details.\nBy the way, I guess I’m not that good at writing. So let’s keep this blog short :P.\nValve CI Infrastructure Valve CI Infrastructure(valve-infra) targets at building a maintenance-free gateway for a bare metal CI farm. The gateway is a machine that interacts with the user over the internet using RESTful APIs and manages the device under test (DUT). ‘Maintenance-free’ means that even if we accidentally load a wrong kernel to the gateway, it could be reset to a correct state with a simple reboot instead of flashing an OS. Therefore, iPXE is used in valve-infra for netboot support so that we can replace the kernel image remotely and use a WiFi smart plug to reboot it.\nIdeally, We want the gateway to be plug-and-play so that people can share their spare machine as a CI runner with ease. However, due to the wide range of platforms available, it is difficult to find a way like some SD card image that boots on all devices. To solve this problem, we require machine owners to provide at least a prebuilt disk image with a working bootloader and iPXE. Then we could add other things to the prebuilt image, such as a new iPXE with the private key for identification when the gateway connects to the iPXE server, and generates a netboot image compatible with valve-infra.\nTo make maintenance of the gateway even easier, we use containers to keep the environment clean between different versions of gateway. Boot2container initramfs was used to fetch and boot directly into a valve-infra container, which is also highly configurable by kernel cmdline.\nThe Project My GSoC project is to port valve-infra to a single board computer (SBC), specifically Raspberry Pi 3B+.\nCurrently valve-infra only supports building an ISO that runs on x86 UEFI platform and lacks generalization as the boot process of SBCs differs vastly. At the first stage, I’ll try to figure out a proper specification for the prebuilt disk image. This should make it clear where the iPXE binary and the tmp partition for boot2container are.\nThen I should adapt valve-infra’s ipxe-boot-server according to the specification above. By adding iPXE related files to the prebuilt disk image correctly, it will generate a netboot image. The netboot image should be able to fetch the kernel, boot2container and finally boot a basic container like alpine:latest.\nAfter that, we need to build an ARM64 version of valve-infra gateway container. Hope we can simply relpace the base image and get everything work fine.\nFinally, a gitlab CI pipeline that automates the disk image building process could be created so that it can be done with a single click.\nIf there’s still time left, I may as well try porting valve-infra to other SBCs. :)\n","wordCount":"517","inLanguage":"en","datePublished":"2023-05-14T20:41:37+08:00","dateModified":"2023-05-14T20:41:37+08:00","author":{"@type":"Person","name":"jpy794"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jpy794.github.io/blog/gsoc-blog-1/"},"publisher":{"@type":"Organization","name":"jpy794","logo":{"@type":"ImageObject","url":"https://jpy794.github.io/favicon.ico"}}}</script><link rel=icon type=image/png href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=/css/main.min.64bc8c4cb2304e84167c1583fa1b5de80f6d5adc95abed2e616dea0ea5680e01.css integrity="sha256-ZLyMTLIwToQWfBWD+htd6A9tWtyVq+0uYW3qDqVoDgE=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.872dfd2cd00064018a833a6e8e77a0fbf8fbac159546f2f205d4dad79a5d8e15.js></script>
<script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/blog>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Archives</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/jpy794><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li><li class="navigation-item navigation-language"><a href=https://jpy794.github.io/zh/>中</a></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>The Project - GSoC '23</h1></header><p><small>May 14, 2023&nbsp;· 517 words&nbsp;· 3 min</small>
<small>·
<a href=https://jpy794.github.io/tags/gsoc/>gsoc</a></small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#valve-ci-infrastructure>Valve CI Infrastructure</a></li><li><a href=#the-project>The Project</a></li></ul></nav></div><section class=blog-content><p>I received the email saying that my proposal for GSoC &lsquo;23 was accepted by <a href=https://www.x.org>X.Org Foundation</a> on May 5th. It’s my first time working with open-source communities and I’m really excited about it. My mentor <a href=http://www.mupuf.org/contact/mupuf.html>Martin Roukala</a> gave me some great advice and helped me understand the project and my tasks better. Now it’s time to dive into the project details.</p><p>By the way, I guess I&rsquo;m not that good at writing. So let&rsquo;s keep this blog short :P.</p><h2 id=valve-ci-infrastructure>Valve CI Infrastructure</h2><p><a href=https://gitlab.freedesktop.org/mupuf/valve-infra>Valve CI Infrastructure</a>(valve-infra) targets at building a maintenance-free gateway for a bare metal CI farm. The gateway is a machine that interacts with the user over the internet using RESTful APIs and manages the device under test (DUT). &lsquo;Maintenance-free&rsquo; means that even if we accidentally load a wrong kernel to the gateway, it could be reset to a correct state with a simple reboot instead of flashing an OS. Therefore, <a href=https://ipxe.org/>iPXE</a> is used in valve-infra for netboot support so that we can replace the kernel image remotely and use a WiFi smart plug to reboot it.</p><p>Ideally, We want the gateway to be plug-and-play so that people can share their spare machine as a CI runner with ease. However, due to the wide range of platforms available, it is difficult to find a way like some SD card image that boots on all devices. To solve this problem, we require machine owners to provide at least a prebuilt disk image with a working bootloader and iPXE. Then we could add other things to the prebuilt image, such as a new iPXE with the private key for identification when the gateway connects to the iPXE server, and generates a netboot image compatible with valve-infra.</p><p>To make maintenance of the gateway even easier, we use containers to keep the environment clean between different versions of gateway. <a href=https://gitlab.freedesktop.org/mupuf/boot2container>Boot2container</a> initramfs was used to fetch and boot directly into a valve-infra container, which is also highly configurable by kernel cmdline.</p><h2 id=the-project>The Project</h2><p>My GSoC project is to port valve-infra to a single board computer (SBC), specifically <a href=https://www.raspberrypi.com/products/raspberry-pi-3-model-b-plus/>Raspberry Pi 3B+</a>.</p><p>Currently valve-infra only supports building an ISO that runs on x86 UEFI platform and lacks generalization as the boot process of SBCs differs vastly. At the first stage, I’ll try to figure out a proper specification for the prebuilt disk image. This should make it clear where the iPXE binary and the tmp partition for boot2container are.</p><p>Then I should adapt valve-infra&rsquo;s ipxe-boot-server according to the specification above. By adding iPXE related files to the prebuilt disk image correctly, it will generate a netboot image. The netboot image should be able to fetch the kernel, boot2container and finally boot a basic container like <code>alpine:latest</code>.</p><p>After that, we need to build an ARM64 version of valve-infra gateway container. Hope we can simply relpace the base image and get everything work fine.</p><p>Finally, a gitlab CI pipeline that automates the disk image building process could be created so that it can be done with a single click.</p><p>If there&rsquo;s still time left, I may as well try porting valve-infra to other SBCs. :)</p></section><div class=paginator><a class=prev href=https://jpy794.github.io/blog/gsoc-blog-2/><span>&larr;&nbsp;&nbsp;</span><span>Getting Started - GSoC '23</span></a></div><div class=related-resources><h3>Related Resources</h3><nav><ul><li><a href=/blog/gsoc-blog-2/>Getting Started - GSoC '23</a></li></ul></nav></div></article></div><footer class=footer><p>&copy; 2023 <a href=https://jpy794.github.io>jpy794</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>