<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>jpy794</title><meta charset=utf-8><meta name=description content="Ladder@This is my final blog post for GSoC &lsquo;23. For me, the past few months have been both challenging and rewarding. Although I didn&rsquo;t achieve all the goals I set out to do, I learned a lot in the process.
What Was Done As mentioned in the last post, we created a new project, boot2ipxe, to build netboot disk image for different platforms. With that as the base image, ipxe-boot-server could generate disk image that boots boot2container from a HTTPS server."><meta name=author content="jpy794"><link rel=canonical href=https://jpy794.github.io/blog/gsoc-blog-4/><meta name=google-site-verification content="hkf8Kk9sh38Hm5TzNLXjKJ-Mb3LCSX4b9e4OZ56KXtw"><meta property="og:title" content="Final Blog Post - GSoC '23"><meta property="og:description" content="This is my final blog post for GSoC &lsquo;23. For me, the past few months have been both challenging and rewarding. Although I didn&rsquo;t achieve all the goals I set out to do, I learned a lot in the process.
What Was Done As mentioned in the last post, we created a new project, boot2ipxe, to build netboot disk image for different platforms. With that as the base image, ipxe-boot-server could generate disk image that boots boot2container from a HTTPS server."><meta property="og:type" content="article"><meta property="og:url" content="https://jpy794.github.io/blog/gsoc-blog-4/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-09-03T16:23:29+08:00"><meta property="article:modified_time" content="2023-09-03T16:23:29+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Final Blog Post - GSoC '23"><meta name=twitter:description content="This is my final blog post for GSoC &lsquo;23. For me, the past few months have been both challenging and rewarding. Although I didn&rsquo;t achieve all the goals I set out to do, I learned a lot in the process.
What Was Done As mentioned in the last post, we created a new project, boot2ipxe, to build netboot disk image for different platforms. With that as the base image, ipxe-boot-server could generate disk image that boots boot2container from a HTTPS server."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blogs","item":"https://jpy794.github.io/blog/"},{"@type":"ListItem","position":3,"name":"Final Blog Post - GSoC '23","item":"https://jpy794.github.io/blog/gsoc-blog-4/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Final Blog Post - GSoC '23","name":"Final Blog Post - GSoC \u002723","description":"This is my final blog post for GSoC \u0026lsquo;23. For me, the past few months have been both challenging and rewarding. Although I didn\u0026rsquo;t achieve all the goals I set out to do, I learned a lot in the process.\nWhat Was Done As mentioned in the last post, we created a new project, boot2ipxe, to build netboot disk image for different platforms. With that as the base image, ipxe-boot-server could generate disk image that boots boot2container from a HTTPS server.","keywords":[],"articleBody":"This is my final blog post for GSoC ‘23. For me, the past few months have been both challenging and rewarding. Although I didn’t achieve all the goals I set out to do, I learned a lot in the process.\nWhat Was Done As mentioned in the last post, we created a new project, boot2ipxe, to build netboot disk image for different platforms. With that as the base image, ipxe-boot-server could generate disk image that boots boot2container from a HTTPS server. Thanks to my mentor who took the time to add ARM64 support to valve-infra container, we can now launch valve-infra on RPi!\nBoot Valve Infra on RPi There’re a few steps to take.\nConfigure the HTTPS server and build your RPi SD card image according to readme of ipxe-boot-server. Download prebuilt kernel and initramfs for RPi from boot2container release put them in the correct place according to readme of ipxe-boot-server. Write a boot script to run valve-infra container with boot2container Here’s a simple example script, which requires manually creating another partition on the SD card as cache partition for valve-infra container image. (Or boot would fail due to lack of disk space.)\nThis script also requires kernel and initramfs to be placed in the same directory as the script. (files/${fingerprint}/)\n#!ipxe kernel /files/linux-arm64-6.5.1 initrd=b2c b2c.run=\"-ti registry.freedesktop.org/mupuf/valve-infra/valve-infra-container:aarch64\" b2c.ntp_peer=auto b2c.cache_device=/dev/mmcblk0p2 initrd --name b2c /files/initramfs.linux_arm64.cpio.xz boot Most of the steps above have been explained in previous blog posts. Check them out if any step is not clear.\nIf everything goes well, you should see something like\n[root@boot2container ~]# /usr/local/lib/dashboard/dashboard.py --services 'avahi-daemon' 'executor' 'minio' 'salad' 'gitlab-runner' '*-registry' 'influxdb' 'influxdb_configure' 'telegraf' 'nftables' 'vpdu' And then you’re in the dashboard of valve-infra.\nThoughts This is my first time participating in a program like GSoC. I should have realized earlier that workload of GSoC isn’t small. Especially it’s my junior year. The class, competition, application season, internship and starting new life in another city, those things can be overwhelming enough. So I think I should learn to let go of some tasks and focus on one thing. Maybe it will work out better that way.\nAnyway, GSoC is a great experience for me. And I would like to express my sincere gratitude to my amazing mentor mupuf for his care and guidance.\n","wordCount":"376","inLanguage":"en","datePublished":"2023-09-03T16:23:29+08:00","dateModified":"2023-09-03T16:23:29+08:00","author":{"@type":"Person","name":"jpy794"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jpy794.github.io/blog/gsoc-blog-4/"},"publisher":{"@type":"Organization","name":"jpy794","logo":{"@type":"ImageObject","url":"https://jpy794.github.io/favicon.ico"}}}</script><link rel=icon type=image/png href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=/css/main.min.64bc8c4cb2304e84167c1583fa1b5de80f6d5adc95abed2e616dea0ea5680e01.css integrity="sha256-ZLyMTLIwToQWfBWD+htd6A9tWtyVq+0uYW3qDqVoDgE=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.872dfd2cd00064018a833a6e8e77a0fbf8fbac159546f2f205d4dad79a5d8e15.js></script>
<script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/blog>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Archives</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/jpy794><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li><li class="navigation-item navigation-language"><a href=https://jpy794.github.io/zh/>中</a></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Final Blog Post - GSoC '23</h1></header><p><small>September 3, 2023&nbsp;· 376 words&nbsp;· 2 min</small>
<small></small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#what-was-done>What Was Done</a></li><li><a href=#boot-valve-infra-on-rpi>Boot Valve Infra on RPi</a></li><li><a href=#thoughts>Thoughts</a></li></ul></nav></div><section class=blog-content><p>This is my final blog post for GSoC &lsquo;23. For me, the past few months have been both challenging and rewarding. Although I didn&rsquo;t achieve all the goals I set out to do, I learned a lot in the process.</p><h2 id=what-was-done>What Was Done</h2><p>As mentioned in the last post, we created a new project, boot2ipxe, to build netboot disk image for different platforms. With that as the base image, ipxe-boot-server could generate disk image that boots boot2container from a HTTPS server. Thanks to my mentor who took the time to add ARM64 support to valve-infra container, we can now launch valve-infra on RPi!</p><h2 id=boot-valve-infra-on-rpi>Boot Valve Infra on RPi</h2><p>There&rsquo;re a few steps to take.</p><ul><li>Configure the HTTPS server and build your RPi SD card image according to readme of ipxe-boot-server.</li><li>Download prebuilt kernel and initramfs for RPi from boot2container release put them in the correct place according to readme of ipxe-boot-server.</li><li>Write a boot script to run valve-infra container with boot2container</li></ul><p>Here&rsquo;s a simple example script, which requires manually creating another partition on the SD card as cache partition for valve-infra container image. (Or boot would fail due to lack of disk space.)</p><p>This script also requires kernel and initramfs to be placed in the same directory as the script. (<code>files/${fingerprint}/</code>)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#!ipxe
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>kernel /files/linux-arm64-6.5.1 initrd<span style=color:#f92672>=</span>b2c b2c.run<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-ti registry.freedesktop.org/mupuf/valve-infra/valve-infra-container:aarch64&#34;</span> b2c.ntp_peer<span style=color:#f92672>=</span>auto b2c.cache_device<span style=color:#f92672>=</span>/dev/mmcblk0p2
</span></span><span style=display:flex><span>initrd --name b2c /files/initramfs.linux_arm64.cpio.xz
</span></span><span style=display:flex><span>boot
</span></span></code></pre></div><p>Most of the steps above have been explained in previous blog posts. Check them out if any step is not clear.</p><p>If everything goes well, you should see something like</p><pre tabindex=0><code>[root@boot2container ~]# /usr/local/lib/dashboard/dashboard.py --services &#39;avahi-daemon&#39; &#39;executor&#39; &#39;minio&#39; &#39;salad&#39; &#39;gitlab-runner&#39; &#39;*-registry&#39; &#39;influxdb&#39; &#39;influxdb_configure&#39; &#39;telegraf&#39; &#39;nftables&#39; &#39;vpdu&#39;
</code></pre><p>And then you&rsquo;re in the dashboard of valve-infra.</p><h2 id=thoughts>Thoughts</h2><p>This is my first time participating in a program like GSoC. I should have realized earlier that workload of GSoC isn&rsquo;t small. Especially it&rsquo;s my junior year. The class, competition, application season, internship and starting new life in another city, those things can be overwhelming enough. So I think I should learn to let go of some tasks and focus on one thing. Maybe it will work out better that way.</p><p>Anyway, GSoC is a great experience for me. And I would like to express my sincere gratitude to my amazing mentor mupuf for his care and guidance.</p></section><div class=paginator><a class=next href=https://jpy794.github.io/blog/gsoc-blog-3/><span>Run Boot2container on RPi - GSoC '23</span><span>&nbsp;&nbsp;&rarr;</span></a></div></article></div><footer class=footer><p>&copy; 2023 <a href=https://jpy794.github.io>jpy794</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>